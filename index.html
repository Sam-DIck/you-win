<!doctype html>
<meta charset=utf-8>
<meta name=viewport content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name=apple-mobile-web-app-capable content=yes>
<meta name=apple-mobile-web-app-status-bar-style content=black>

<style>
body {
  overflow: hidden;
  position: fixed;
  background: #000;
}
</style>
<body>
<script src=uw/gyronorm.js></script>
<script src=uw/emitter.js></script>
<script src=uw/emojis.js></script>
<script src=uw/sprites.js></script>
<script>
var {forever, Phone, Costume, Sprite, World} = UW
var world
var phone = new Phone()

var debug = document.createElement('pre')

UW.init({
  smile: 'https://emojipedia-us.s3.amazonaws.com/thumbs/320/emoji-one/104/grinning-face_1f600.png',
  platform: Costume.emoji('🕳️'),
  bird: Costume.emoji('🐦'),
}, () => {

  world = new World({
    background: '#fff',
  })
  world._root.appendChild(debug)

  var scrollVel = 0

  var player = new Sprite('bird', {
    scale: 5,
  })
  player.yVel = 0
  forever(() => {
    var xVel = 10 * UW.sin(phone.zAngle)
    if (xVel > 1) player.flipped = true
    if (xVel < -1) player.flipped = false
    player.x += xVel
    debug.textContent = JSON.stringify({xVel, phone}).replace(/,/g, '\n')
    player.y += player.yVel
    player.yVel -= 1
    player.x = Math.max(72, Math.min(world.width - 72, player.x))
    if (player.yVel < -16) { // < 72) {
      //player.y = 72
      player.yVel = 42
    }
    const barrier = world.height * 0.75
    const diff = player.y + world.scrollY - barrier
    if (diff > 0) {
      world.scrollY -= diff
    }
    if (player.y > world.height / 2 && player.yVel > 0) {
      // world.scrollY -= player.yVel
      // scrollVel += 0.1 * player.yVel
      // world.scrollY -= scrollVel
      // scrollVel *= 0.8
    }
  })

  for (var i=0; i<100; i++) {
    var platform = new Sprite('platform', {
      x: Math.random() * world.width,
      y: 200 * i,
      scale: 6,
    })
    player.raise()
  }

  world.start()

})

</script>

